{"ast":null,"code":"import{Navigate,useLocation}from\"react-router-dom\";import React from\"react\";import jwt_decode from\"jwt-decode\";import{storage}from\"@shared/utils\";import{jsx as _jsx}from\"react/jsx-runtime\";export var getSession=function getSession(){try{var token=storage.getToken();if(token){return jwt_decode(token);}else{return false;}}catch(error){return false;}};export var getPermissions=function getPermissions(){try{var token=storage.getToken();if(token){var decodeAccessToken=jwt_decode(token);var decodePermissionToken=jwt_decode(decodeAccessToken.permissions);return decodePermissionToken===null||decodePermissionToken===void 0?void 0:decodePermissionToken.permissions;}else{return[];}}catch(error){return[];}};export var hasAccessPermission=function hasAccessPermission(allowedAccess,userPermissions){var hasAccess=userPermissions.filter(function(role){return allowedAccess.includes(role);});return hasAccess.length>0;};export var RouteAuthorization=function RouteAuthorization(_ref){var allowedAccess=_ref.allowedAccess,Component=_ref.component;var location=useLocation();var hasAccess=hasAccessPermission(allowedAccess,getPermissions());return hasAccess?/*#__PURE__*/_jsx(Component,{}):/*#__PURE__*/_jsx(Navigate,{to:\"/\",state:{from:location}});};export var Authorization=function Authorization(_ref2){var allowedAccess=_ref2.allowedAccess,children=_ref2.children,_ref2$forbiddenFallba=_ref2.forbiddenFallback,forbiddenFallback=_ref2$forbiddenFallba===void 0?/*#__PURE__*/_jsx(\"h4\",{children:\"Forbidden Access\"}):_ref2$forbiddenFallba;// const hasAccess: boolean = hasAccessPermission(\n// \tallowedAccess,\n// \tgetPermissions()\n// )\n//Temporary\nreturn children;// return hasAccess ? children : forbiddenFallback\n};","map":{"version":3,"sources":["/home/jobayer/Documents/@poshapets/poshapets-admin/src/@modules/auth/lib/index.tsx"],"names":["Navigate","useLocation","React","jwt_decode","storage","getSession","token","getToken","error","getPermissions","decodeAccessToken","decodePermissionToken","permissions","hasAccessPermission","allowedAccess","userPermissions","hasAccess","filter","role","includes","length","RouteAuthorization","Component","component","location","from","Authorization","children","forbiddenFallback"],"mappings":"AAAA,OAASA,QAAT,CAAmBC,WAAnB,KAAsC,kBAAtC,CAIA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,OAASC,OAAT,KAAwB,eAAxB,C,2CAEA,MAAO,IAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAA0B,CACnD,GAAI,CACH,GAAMC,CAAAA,KAAuB,CAAGF,OAAO,CAACG,QAAR,EAAhC,CACA,GAAID,KAAJ,CAAW,CACV,MAAOH,CAAAA,UAAU,CAACG,KAAD,CAAjB,CACA,CAFD,IAEO,CACN,MAAO,MAAP,CACA,CACD,CAAC,MAAOE,KAAP,CAAc,CACf,MAAO,MAAP,CACA,CACD,CAXM,CAYP,MAAO,IAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAqB,CAClD,GAAI,CACH,GAAMH,CAAAA,KAAuB,CAAGF,OAAO,CAACG,QAAR,EAAhC,CACA,GAAID,KAAJ,CAAW,CACV,GAAMI,CAAAA,iBAA2B,CAAGP,UAAU,CAACG,KAAD,CAA9C,CACA,GAAMK,CAAAA,qBAA0B,CAAGR,UAAU,CAC5CO,iBAAiB,CAACE,WAD0B,CAA7C,CAGA,MAAOD,CAAAA,qBAAP,SAAOA,qBAAP,iBAAOA,qBAAqB,CAAEC,WAA9B,CACA,CAND,IAMO,CACN,MAAO,EAAP,CACA,CACD,CAAC,MAAOJ,KAAP,CAAc,CACf,MAAO,EAAP,CACA,CACD,CAfM,CAiBP,MAAO,IAAMK,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAClCC,aADkC,CAElCC,eAFkC,CAGrB,CACb,GAAMC,CAAAA,SAAS,CAAGD,eAAe,CAACE,MAAhB,CAAuB,SAACC,IAAD,QACxCJ,CAAAA,aAAa,CAACK,QAAd,CAAuBD,IAAvB,CADwC,EAAvB,CAAlB,CAIA,MAAOF,CAAAA,SAAS,CAACI,MAAV,CAAmB,CAA1B,CACA,CATM,CAgBP,MAAO,IAAMC,CAAAA,kBAAiD,CAAG,QAApDA,CAAAA,kBAAoD,MAG3D,IAFLP,CAAAA,aAEK,MAFLA,aAEK,CADMQ,SACN,MADLC,SACK,CACL,GAAIC,CAAAA,QAAQ,CAAGvB,WAAW,EAA1B,CACA,GAAMe,CAAAA,SAAkB,CAAGH,mBAAmB,CAC7CC,aAD6C,CAE7CL,cAAc,EAF+B,CAA9C,CAIA,MAAOO,CAAAA,SAAS,cACf,KAAC,SAAD,IADe,cAGf,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,CAAiB,KAAK,CAAE,CAAES,IAAI,CAAED,QAAR,CAAxB,EAHD,CAKA,CAdM,CAeP,MAAO,IAAME,CAAAA,aAIX,CAAG,QAJQA,CAAAA,aAIR,OAIC,IAHLZ,CAAAA,aAGK,OAHLA,aAGK,CAFLa,QAEK,OAFLA,QAEK,6BADLC,iBACK,CADLA,iBACK,6CADe,wCACf,uBACL;AACA;AACA;AACA;AACA;AACA,MAAOD,CAAAA,QAAP,CACA;AACA,CAhBM","sourcesContent":["import { Navigate, useLocation } from \"react-router-dom\"\n\nimport { ISession } from \"..\"\nimport { PermissionsTypes } from \"@shared/enums\"\nimport React from \"react\"\nimport jwt_decode from \"jwt-decode\"\nimport { storage } from \"@shared/utils\"\n\nexport const getSession = (): ISession | boolean => {\n\ttry {\n\t\tconst token: string | boolean = storage.getToken()\n\t\tif (token) {\n\t\t\treturn jwt_decode(token)\n\t\t} else {\n\t\t\treturn false\n\t\t}\n\t} catch (error) {\n\t\treturn false\n\t}\n}\nexport const getPermissions = (): string[] | [] => {\n\ttry {\n\t\tconst token: string | boolean = storage.getToken()\n\t\tif (token) {\n\t\t\tconst decodeAccessToken: ISession = jwt_decode(token)\n\t\t\tconst decodePermissionToken: any = jwt_decode(\n\t\t\t\tdecodeAccessToken.permissions\n\t\t\t)\n\t\t\treturn decodePermissionToken?.permissions\n\t\t} else {\n\t\t\treturn []\n\t\t}\n\t} catch (error) {\n\t\treturn []\n\t}\n}\n\nexport const hasAccessPermission = (\n\tallowedAccess: string[],\n\tuserPermissions: string[]\n): boolean => {\n\tconst hasAccess = userPermissions.filter((role: string) =>\n\t\tallowedAccess.includes(role)\n\t)\n\n\treturn hasAccess.length > 0\n}\n\ninterface IRouteAuthorization {\n\tallowedAccess: PermissionsTypes[]\n\tcomponent: any\n}\n\nexport const RouteAuthorization: React.FC<IRouteAuthorization> = ({\n\tallowedAccess,\n\tcomponent: Component,\n}) => {\n\tlet location = useLocation()\n\tconst hasAccess: boolean = hasAccessPermission(\n\t\tallowedAccess,\n\t\tgetPermissions()\n\t)\n\treturn hasAccess ? (\n\t\t<Component />\n\t) : (\n\t\t<Navigate to=\"/\" state={{ from: location }} />\n\t)\n}\nexport const Authorization: React.FC<{\n\tallowedAccess: PermissionsTypes[]\n\tchildren?: any\n\tforbiddenFallback?: any\n}> = ({\n\tallowedAccess,\n\tchildren,\n\tforbiddenFallback = <h4>Forbidden Access</h4>,\n}) => {\n\t// const hasAccess: boolean = hasAccessPermission(\n\t// \tallowedAccess,\n\t// \tgetPermissions()\n\t// )\n\t//Temporary\n\treturn children\n\t// return hasAccess ? children : forbiddenFallback\n}\n"]},"metadata":{},"sourceType":"module"}