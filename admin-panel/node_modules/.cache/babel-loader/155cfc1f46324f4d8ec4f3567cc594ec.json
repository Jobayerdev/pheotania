{"ast":null,"code":"var __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport useUnmount from '../useUnmount';\nimport usePersistFn from '../usePersistFn';\nimport { useEffect, useRef, useState } from 'react';\nexport var ReadyState;\n\n(function (ReadyState) {\n  ReadyState[ReadyState[\"Connecting\"] = 0] = \"Connecting\";\n  ReadyState[ReadyState[\"Open\"] = 1] = \"Open\";\n  ReadyState[ReadyState[\"Closing\"] = 2] = \"Closing\";\n  ReadyState[ReadyState[\"Closed\"] = 3] = \"Closed\";\n})(ReadyState || (ReadyState = {}));\n\nexport default function useWebSocket(socketUrl, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _a = options.reconnectLimit,\n      reconnectLimit = _a === void 0 ? 3 : _a,\n      _b = options.reconnectInterval,\n      reconnectInterval = _b === void 0 ? 3 * 1000 : _b,\n      _c = options.manual,\n      manual = _c === void 0 ? false : _c,\n      onOpen = options.onOpen,\n      onClose = options.onClose,\n      onMessage = options.onMessage,\n      onError = options.onError;\n  var reconnectTimesRef = useRef(0);\n  var reconnectTimerRef = useRef();\n  var websocketRef = useRef();\n\n  var _d = __read(useState(), 2),\n      latestMessage = _d[0],\n      setLatestMessage = _d[1];\n\n  var _e = __read(useState(ReadyState.Closed), 2),\n      readyState = _e[0],\n      setReadyState = _e[1];\n  /**\n   * 重连\n   */\n\n\n  var reconnect = usePersistFn(function () {\n    var _a;\n\n    if (reconnectTimesRef.current < reconnectLimit && ((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) !== ReadyState.Open) {\n      reconnectTimerRef.current && clearTimeout(reconnectTimerRef.current);\n      reconnectTimerRef.current = setTimeout(function () {\n        connectWs();\n        reconnectTimesRef.current++;\n      }, reconnectInterval);\n    }\n  });\n  var connectWs = usePersistFn(function () {\n    reconnectTimerRef.current && clearTimeout(reconnectTimerRef.current);\n\n    if (websocketRef.current) {\n      websocketRef.current.close();\n    }\n\n    try {\n      websocketRef.current = new WebSocket(socketUrl);\n\n      websocketRef.current.onerror = function (event) {\n        var _a;\n\n        reconnect();\n        onError && onError(event);\n        setReadyState(((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) || ReadyState.Closed);\n      };\n\n      websocketRef.current.onopen = function (event) {\n        var _a;\n\n        onOpen && onOpen(event);\n        reconnectTimesRef.current = 0;\n        setReadyState(((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) || ReadyState.Closed);\n      };\n\n      websocketRef.current.onmessage = function (message) {\n        onMessage && onMessage(message);\n        setLatestMessage(message);\n      };\n\n      websocketRef.current.onclose = function (event) {\n        var _a;\n\n        reconnect();\n        onClose && onClose(event);\n        setReadyState(((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) || ReadyState.Closed);\n      };\n    } catch (error) {\n      throw error;\n    }\n  });\n  /**\n   * 发送消息\n   * @param message\n   */\n\n  var sendMessage = usePersistFn(function (message) {\n    var _a;\n\n    if (readyState === ReadyState.Open) {\n      (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.send(message);\n    } else {\n      throw new Error('WebSocket disconnected');\n    }\n  });\n  /**\n   * 手动 connect\n   */\n\n  var connect = usePersistFn(function () {\n    reconnectTimesRef.current = 0;\n    connectWs();\n  });\n  /**\n   * disconnect websocket\n   */\n\n  var disconnect = usePersistFn(function () {\n    var _a;\n\n    reconnectTimerRef.current && clearTimeout(reconnectTimerRef.current);\n    reconnectTimesRef.current = reconnectLimit;\n    (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.close();\n  });\n  useEffect(function () {\n    // 初始连接\n    if (!manual) {\n      connect();\n    }\n  }, [socketUrl, manual]);\n  useUnmount(function () {\n    disconnect();\n  });\n  return {\n    latestMessage: latestMessage,\n    sendMessage: sendMessage,\n    connect: connect,\n    disconnect: disconnect,\n    readyState: readyState,\n    webSocketIns: websocketRef.current\n  };\n}","map":{"version":3,"sources":["/home/jobayer/Documents/@poshapets/poshapets-admin/node_modules/ahooks/es/useWebSocket/index.js"],"names":["__read","o","n","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","useUnmount","usePersistFn","useEffect","useRef","useState","ReadyState","useWebSocket","socketUrl","options","_a","reconnectLimit","_b","reconnectInterval","_c","manual","onOpen","onClose","onMessage","onError","reconnectTimesRef","reconnectTimerRef","websocketRef","_d","latestMessage","setLatestMessage","_e","Closed","readyState","setReadyState","reconnect","current","Open","clearTimeout","setTimeout","connectWs","close","WebSocket","onerror","event","onopen","onmessage","message","onclose","sendMessage","send","Error","connect","disconnect","webSocketIns"],"mappings":"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","sourcesContent":["var __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nimport useUnmount from '../useUnmount';\nimport usePersistFn from '../usePersistFn';\nimport { useEffect, useRef, useState } from 'react';\nexport var ReadyState;\n\n(function (ReadyState) {\n  ReadyState[ReadyState[\"Connecting\"] = 0] = \"Connecting\";\n  ReadyState[ReadyState[\"Open\"] = 1] = \"Open\";\n  ReadyState[ReadyState[\"Closing\"] = 2] = \"Closing\";\n  ReadyState[ReadyState[\"Closed\"] = 3] = \"Closed\";\n})(ReadyState || (ReadyState = {}));\n\nexport default function useWebSocket(socketUrl, options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _a = options.reconnectLimit,\n      reconnectLimit = _a === void 0 ? 3 : _a,\n      _b = options.reconnectInterval,\n      reconnectInterval = _b === void 0 ? 3 * 1000 : _b,\n      _c = options.manual,\n      manual = _c === void 0 ? false : _c,\n      onOpen = options.onOpen,\n      onClose = options.onClose,\n      onMessage = options.onMessage,\n      onError = options.onError;\n  var reconnectTimesRef = useRef(0);\n  var reconnectTimerRef = useRef();\n  var websocketRef = useRef();\n\n  var _d = __read(useState(), 2),\n      latestMessage = _d[0],\n      setLatestMessage = _d[1];\n\n  var _e = __read(useState(ReadyState.Closed), 2),\n      readyState = _e[0],\n      setReadyState = _e[1];\n  /**\n   * 重连\n   */\n\n\n  var reconnect = usePersistFn(function () {\n    var _a;\n\n    if (reconnectTimesRef.current < reconnectLimit && ((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) !== ReadyState.Open) {\n      reconnectTimerRef.current && clearTimeout(reconnectTimerRef.current);\n      reconnectTimerRef.current = setTimeout(function () {\n        connectWs();\n        reconnectTimesRef.current++;\n      }, reconnectInterval);\n    }\n  });\n  var connectWs = usePersistFn(function () {\n    reconnectTimerRef.current && clearTimeout(reconnectTimerRef.current);\n\n    if (websocketRef.current) {\n      websocketRef.current.close();\n    }\n\n    try {\n      websocketRef.current = new WebSocket(socketUrl);\n\n      websocketRef.current.onerror = function (event) {\n        var _a;\n\n        reconnect();\n        onError && onError(event);\n        setReadyState(((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) || ReadyState.Closed);\n      };\n\n      websocketRef.current.onopen = function (event) {\n        var _a;\n\n        onOpen && onOpen(event);\n        reconnectTimesRef.current = 0;\n        setReadyState(((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) || ReadyState.Closed);\n      };\n\n      websocketRef.current.onmessage = function (message) {\n        onMessage && onMessage(message);\n        setLatestMessage(message);\n      };\n\n      websocketRef.current.onclose = function (event) {\n        var _a;\n\n        reconnect();\n        onClose && onClose(event);\n        setReadyState(((_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) || ReadyState.Closed);\n      };\n    } catch (error) {\n      throw error;\n    }\n  });\n  /**\n   * 发送消息\n   * @param message\n   */\n\n  var sendMessage = usePersistFn(function (message) {\n    var _a;\n\n    if (readyState === ReadyState.Open) {\n      (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.send(message);\n    } else {\n      throw new Error('WebSocket disconnected');\n    }\n  });\n  /**\n   * 手动 connect\n   */\n\n  var connect = usePersistFn(function () {\n    reconnectTimesRef.current = 0;\n    connectWs();\n  });\n  /**\n   * disconnect websocket\n   */\n\n  var disconnect = usePersistFn(function () {\n    var _a;\n\n    reconnectTimerRef.current && clearTimeout(reconnectTimerRef.current);\n    reconnectTimesRef.current = reconnectLimit;\n    (_a = websocketRef.current) === null || _a === void 0 ? void 0 : _a.close();\n  });\n  useEffect(function () {\n    // 初始连接\n    if (!manual) {\n      connect();\n    }\n  }, [socketUrl, manual]);\n  useUnmount(function () {\n    disconnect();\n  });\n  return {\n    latestMessage: latestMessage,\n    sendMessage: sendMessage,\n    connect: connect,\n    disconnect: disconnect,\n    readyState: readyState,\n    webSocketIns: websocketRef.current\n  };\n}"]},"metadata":{},"sourceType":"module"}